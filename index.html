<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>九州行程助手 (可編輯版)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #5f548a;
      --accent-color: #7e7cb2;
      --bg-color: #f4f4f8;
      --card-bg: #ffffff;
      --text-main: #333333;
      --text-sub: #666666;
      --danger-color: #ff6b6b;
      --success-color: #51cf66;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, "微軟正黑體", sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      background-color: var(--bg-color);
      color: var(--text-main);
      overflow: hidden;
    }

    /* --- 左側/上方 日期選單 --- */
    #dateList {
      width: 240px;
      background: #fff;
      display: flex;
      flex-direction: column;
      padding: 20px 10px;
      box-shadow: 2px 0 15px rgba(0,0,0,0.05);
      overflow-y: auto;
      z-index: 10;
      flex-shrink: 0;
      position: relative;
    }

    #dateList button {
      background: transparent;
      border: none;
      padding: 15px 20px;
      margin-bottom: 8px;
      border-radius: 12px;
      color: var(--text-sub);
      font-size: 16px;
      font-weight: 600;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #dateList button:hover {
      background-color: #f0f0f5;
      color: var(--primary-color);
    }

    #dateList button.active {
      background: linear-gradient(135deg, #7e7cb2 0%, #5f548a 100%);
      color: #fff;
      box-shadow: 0 4px 12px rgba(95, 84, 138, 0.3);
    }
    
    #dateList button .day-label {
        font-size: 14px;
        opacity: 0.8;
    }

    .btn-reset {
        margin-top: auto;
        background-color: #ffecec !important;
        color: var(--danger-color) !important;
        justify-content: center !important;
        font-size: 14px !important;
    }

    /* --- 右側 詳細內容區 --- */
    #details {
      flex-grow: 1;
      padding: 0;
      overflow-y: auto;
      position: relative;
      scroll-behavior: smooth;
    }

    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px 100px 20px; /* 底部留白給懸浮按鈕 */
    }

    h2 {
      margin: 0 0 20px 0;
      font-size: 28px;
      font-weight: 800;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    h2 i { font-size: 24px; opacity: 0.8; }

    /* --- 行程卡片設計 --- */
    .timeline-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      display: flex;
      align-items: stretch;
      border: 1px solid rgba(0,0,0,0.03);
      transition: transform 0.2s;
      position: relative; /* For absolute positioning of edit buttons */
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    /* 卡片操作區 (編輯/刪除) */
    .card-tools {
        position: absolute;
        top: 10px;
        right: 10px;
        display: none; /* 預設隱藏，hover顯示 */
        gap: 8px;
    }
    .card:hover .card-tools {
        display: flex;
    }
    .btn-tool {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        transition: background 0.2s;
    }
    .btn-edit { background: #e3f2fd; color: #1976d2; }
    .btn-delete { background: #ffebee; color: #d32f2f; }
    
    /* 左側：時間區塊 */
    .card-time {
      flex: 0 0 90px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin-right: 16px;
      padding-right: 16px;
      border-right: 2px solid #f0f0f0;
      color: var(--accent-color);
      font-size: 14px;
      font-weight: 700;
      text-align: right;
      line-height: 1.4;
    }
    
    .card-time span { display: block; }

    /* 中間：資訊區塊 */
    .card-info {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-right: 40px; /* 留位置給工具按鈕 */
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 6px;
      line-height: 1.3;
    }

    .card-location {
      font-size: 14px;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* 右側：地圖按鈕 */
    .card-action {
      flex: 0 0 50px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .btn-map {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background-color: #eff2ff;
      color: #4c6ef5;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      font-size: 18px;
      transition: background 0.2s;
    }

    .btn-map:hover {
      background-color: #4c6ef5;
      color: white;
    }

    /* --- 提醒區塊 --- */
    #reminder {
      margin-top: 30px;
      background: #fff8e1;
      border-left: 5px solid #ffca28;
      padding: 20px;
      border-radius: 8px;
      color: #6d5c00;
      position: relative;
    }

    .reminder-edit-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        border: none;
        color: #bfa026;
        cursor: pointer;
        font-size: 16px;
    }

    #reminder h3 {
      margin: 0 0 10px 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    ul.reminder-list {
      margin: 0;
      padding-left: 20px;
    }

    ul.reminder-list li {
      margin-bottom: 6px;
      line-height: 1.6;
      font-size: 16px;
    }

    /* --- 懸浮新增按鈕 (FAB) --- */
    .fab-add {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background-color: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: 0 4px 15px rgba(95, 84, 138, 0.4);
        border: none;
        cursor: pointer;
        transition: transform 0.2s;
        z-index: 100;
    }
    .fab-add:hover {
        transform: scale(1.1);
        background-color: var(--accent-color);
    }

    /* --- Modal 彈窗 --- */
    .modal-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s;
    }
    .modal-overlay.open {
        visibility: visible;
        opacity: 1;
    }
    .modal-box {
        background: white;
        width: 90%;
        max-width: 500px;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .modal-header { font-size: 20px; font-weight: bold; margin-bottom: 16px; color: var(--primary-color); }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
    .form-group input, .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
    }
    .form-group textarea { resize: vertical; min-height: 80px; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
    .btn-cancel { background: #eee; color: #333; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }
    .btn-save { background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; }

    /* --- 手機版響應式調整 --- */
    @media(max-width: 768px) {
      body { flex-direction: column; }
      #dateList {
        width: 100%;
        height: auto;
        flex-direction: row;
        overflow-x: auto;
        padding: 12px 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        -ms-overflow-style: none; 
        scrollbar-width: none;
      }
      #dateList::-webkit-scrollbar { display: none; }
      #dateList button {
        flex: 0 0 auto;
        margin: 0 6px;
        padding: 8px 16px;
        margin-bottom: 0;
        border-radius: 20px;
        font-size: 14px;
      }
      #dateList button .day-label { display: none; }
      
      .btn-reset { display: none; } /* 手機版為了美觀暫時隱藏重置按鈕，或可移至底部 */

      .content-container { padding: 20px 15px 80px 15px; }
      .card { padding: 12px; }
      /* 手機版讓工具列直接顯示，方便操作 */
      .card-tools { display: flex; position: relative; top: 0; right: 0; justify-content: flex-end; margin-bottom: 8px; }
      .card { flex-direction: column; }
      .card-time { 
          border-right: none; border-bottom: 1px solid #f0f0f0; 
          margin-right: 0; margin-bottom: 8px; padding-bottom: 8px; 
          flex: auto; text-align: left;
      }
      .card-info { padding-right: 0; }
      .card-action { display: none; } /* 手機版隱藏地圖按鈕圖示，直接點卡片標題連結 */
      
      /* 改讓標題變成可點擊的地圖連結 */
      .card-title a { color: inherit; text-decoration: none; border-bottom: 1px dotted #999; }
    }
  </style>
</head>
<body>

  <div id="dateList"></div>

  <div id="details">
    <div class="content-container">
      <h2 id="dateTitle"><i class="far fa-calendar-alt"></i> <span>請選擇日期</span></h2>
      <div id="itinerary" class="timeline-container"></div>
      <div id="reminder"></div>
    </div>
  </div>

  <button class="fab-add" onclick="openModal()"><i class="fas fa-plus"></i></button>

  <div class="modal-overlay" id="itemModal">
      <div class="modal-box">
          <div class="modal-header" id="modalHeader">新增行程</div>
          <div class="form-group">
              <label>時間 (例如: 10:00-12:00)</label>
              <input type="text" id="inputTime" placeholder="輸入時間或註解">
          </div>
          <div class="form-group">
              <label>名稱 (地點/餐廳名)</label>
              <input type="text" id="inputName" placeholder="輸入行程名稱">
          </div>
          <div class="form-group">
              <label>地址/定位 (用於導航)</label>
              <input type="text" id="inputLocation" placeholder="輸入用於 Google Maps 的地址">
          </div>
          <div class="modal-actions">
              <button class="btn-cancel" onclick="closeModal()">取消</button>
              <button class="btn-save" onclick="saveItem()">儲存</button>
          </div>
      </div>
  </div>

  <div class="modal-overlay" id="reminderModal">
      <div class="modal-box">
          <div class="modal-header">編輯本日提醒</div>
          <div class="form-group">
              <label>提醒事項 (一行一個)</label>
              <textarea id="inputReminder" placeholder="請輸入提醒事項，換行區隔..."></textarea>
          </div>
          <div class="modal-actions">
              <button class="btn-cancel" onclick="closeReminderModal()">取消</button>
              <button class="btn-save" onclick="saveReminder()">儲存</button>
          </div>
      </div>
  </div>

  <script>
    // === 1. 預設資料 (若沒有儲存紀錄時使用) ===
    const defaultData = {
      "2025-12-04": {
        itinerary: [
          { time: "午餐 11:00〜14:30", name: "高千穂牛レストラン 和", location: "高千穂牛レストラン 和" },
          { time: "景點", name: "高千穗峽", location: "第1御鹽井停車場" },
          { time: "入住 15:00-23:00", name: "Airbnb", location: "2-chōme-8-54 Rendaiji, Nishi Ward, Kumamoto" }
        ],
        reminder: [ "【航班】JX846 07:30-10:35", "【BUDGET租賃】 預約號碼 : 00009540394" ]
      },
      "2025-12-05": {
        itinerary: [
          { time: "遊船 10:50", name: "柳川川下り伯舟観光", location: "KAMENOI HOTEL YANAGAWA" },
          { time: "逛", name: "鳥栖PREMIUM OUTLETS", location: "鳥栖PREMIUM OUTLETS" },
          { time: "入住", name: "Airbnb (amp flat)", location: "2-chōme-11-19 Kego, Chuo Ward, Fukuoka" }
        ],
        reminder: [ "記得攜帶泡腳用的小毛巾。", "遊船：上午11:00預約，請前5分鐘抵達。" ]
      },
      "2025-12-06": {
        itinerary: [
          { time: "景點 24H", name: "西溪公園 (楓葉)", location: "西渓公園" },
          { time: "書店 09:00–21:00", name: "武雄市圖書館", location: "武雄市圖書館" },
          { time: "晚餐", name: "一蘭 太宰府店", location: "3 Chome-1-30 Mukaizano, Dazaifu" }
        ],
        reminder: [ "武雄圖書館：內部禁止拍照，請留意。" ]
      }
    };

    // 完整的日期清單
    const allDates = [
      "2025-12-04", "2025-12-05", "2025-12-06",
      "2025-12-07", "2025-12-08", "2025-12-09"
    ];

    // === 全域變數 ===
    let appData = {};
    let currentDate = null;
    let editingIndex = -1; // -1 代表新增，其他數字代表編輯第幾個項目

    // === DOM 元素 ===
    const dateListDiv = document.getElementById("dateList");
    const dateTitle = document.getElementById("dateTitle");
    const itineraryDiv = document.getElementById("itinerary");
    const reminderDiv = document.getElementById("reminder");
    const itemModal = document.getElementById("itemModal");
    const reminderModal = document.getElementById("reminderModal");

    // === Helper: 日期轉星期 ===
    function getDayLabel(dateString) {
        const days = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
        const d = new Date(dateString);
        return days[d.getDay()];
    }

    // === 2. 初始化與資料讀取 ===
    function init() {
        // 嘗試從 localStorage 讀取
        const saved = localStorage.getItem('kyushu_trip_data');
        if (saved) {
            appData = JSON.parse(saved);
            // 檢查是否有遺漏的日期key，若有則補上空結構
            allDates.forEach(date => {
                if(!appData[date]) appData[date] = { itinerary: [], reminder: [] };
            });
        } else {
            // 如果沒存過，使用預設資料，並補齊其他日期
            appData = JSON.parse(JSON.stringify(defaultData));
            allDates.forEach(date => {
                if(!appData[date]) appData[date] = { itinerary: [], reminder: [] };
            });
        }
        
        currentDate = allDates[0];
        renderDateList();
        renderContent();
    }

    function saveDataToStorage() {
        localStorage.setItem('kyushu_trip_data', JSON.stringify(appData));
    }

    function resetData() {
        if(confirm("確定要重置所有資料嗎？您的修改將會消失。")) {
            localStorage.removeItem('kyushu_trip_data');
            location.reload();
        }
    }

    // === 3. 畫面渲染 ===
    function renderDateList() {
      dateListDiv.innerHTML = "";
      allDates.forEach(date => {
        const dayLabel = getDayLabel(date);
        const btn = document.createElement("button");
        const shortDate = date.substring(5).replace('-', '/');
        btn.innerHTML = `<span>${shortDate}</span> <span class="day-label">${dayLabel}</span>`;
        
        if (date === currentDate) btn.classList.add("active");
        
        btn.addEventListener("click", () => {
          document.querySelector('#dateList button.active')?.classList.remove('active');
          btn.classList.add('active');
          currentDate = date;
          renderContent();
          if (window.innerWidth <= 768) {
              btn.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
          }
        });
        dateListDiv.appendChild(btn);
      });

      // 加入重置按鈕
      const resetBtn = document.createElement("button");
      resetBtn.className = "btn-reset";
      resetBtn.innerHTML = '<i class="fas fa-undo"></i> 重置資料';
      resetBtn.onclick = resetData;
      dateListDiv.appendChild(resetBtn);
    }

    function renderContent() {
      if (!currentDate) return;
      
      // 更新標題
      dateTitle.querySelector('span').textContent = `${currentDate} (${getDayLabel(currentDate)})`;
      
      // 清空目前內容
      itineraryDiv.innerHTML = "";
      reminderDiv.innerHTML = "";

      const dayData = appData[currentDate];
      
      // 渲染行程卡片
      if (dayData.itinerary.length === 0) {
        itineraryDiv.innerHTML = `<div style="font-size:16px; color:#aaa; padding:30px; text-align:center; border: 2px dashed #ddd; border-radius:12px;">點擊右下角 + 新增行程</div>`;
      } else {
        dayData.itinerary.forEach((item, index) => {
          const card = document.createElement("div");
          card.classList.add("card");
          
          // Google Map Link
          const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}`;
          
          card.innerHTML = `
            <div class="card-tools">
                <button class="btn-tool btn-edit" onclick="editItem(${index})"><i class="fas fa-pen"></i></button>
                <button class="btn-tool btn-delete" onclick="deleteItem(${index})"><i class="fas fa-trash"></i></button>
            </div>
            <div class="card-time">
               ${item.time}
            </div>
            <div class="card-info">
              <div class="card-title">
                ${window.innerWidth <= 768 ? `<a href="${mapLink}" target="_blank">${item.name}</a>` : item.name}
              </div>
              <div class="card-location">
                <i class="fas fa-map-marker-alt"></i> ${item.location}
              </div>
            </div>
            <div class="card-action">
                <a href="${mapLink}" target="_blank" class="btn-map" title="開啟地圖">
                    <i class="fas fa-location-arrow"></i>
                </a>
            </div>
          `;
          itineraryDiv.appendChild(card);
        });
      }

      // 渲染提醒事項
      let reminderHtml = `
          <button class="reminder-edit-btn" onclick="openReminderModal()"><i class="fas fa-edit"></i> 編輯提醒</button>
          <h3><i class="fas fa-exclamation-circle"></i> 重要提醒</h3>
      `;
      
      if (dayData.reminder && dayData.reminder.length > 0) {
        reminderHtml += `<ul class="reminder-list">${dayData.reminder.map(r => `<li>${r}</li>`).join("")}</ul>`;
      } else {
        reminderHtml += `<div style="color:#998a4b; font-size:14px; font-style:italic;">尚無提醒事項</div>`;
      }
      reminderDiv.innerHTML = reminderHtml;
    }

    // === 4. 新增/修改/刪除 行程邏輯 ===

    function openModal() {
        // 新增模式
        editingIndex = -1;
        document.getElementById('modalHeader').textContent = "新增行程";
        document.getElementById('inputTime').value = "";
        document.getElementById('inputName').value = "";
        document.getElementById('inputLocation').value = "";
        itemModal.classList.add('open');
    }

    function editItem(index) {
        // 編輯模式
        editingIndex = index;
        const item = appData[currentDate].itinerary[index];
        document.getElementById('modalHeader').textContent = "編輯行程";
        document.getElementById('inputTime').value = item.time;
        document.getElementById('inputName').value = item.name;
        document.getElementById('inputLocation').value = item.location;
        itemModal.classList.add('open');
    }

    function closeModal() {
        itemModal.classList.remove('open');
    }

    function saveItem() {
        const time = document.getElementById('inputTime').value.trim();
        const name = document.getElementById('inputName').value.trim();
        const location = document.getElementById('inputLocation').value.trim();

        if (!name) { alert("請至少輸入名稱"); return; }

        const newItem = { time, name, location };

        if (editingIndex === -1) {
            // 新增
            appData[currentDate].itinerary.push(newItem);
        } else {
            // 修改
            appData[currentDate].itinerary[editingIndex] = newItem;
        }

        saveDataToStorage();
        renderContent();
        closeModal();
    }

    function deleteItem(index) {
        if(confirm("確定要刪除這個行程嗎？")) {
            appData[currentDate].itinerary.splice(index, 1);
            saveDataToStorage();
            renderContent();
        }
    }

    // === 5. 提醒事項編輯邏輯 ===

    function openReminderModal() {
        const reminders = appData[currentDate].reminder || [];
        document.getElementById('inputReminder').value = reminders.join("\n");
        reminderModal.classList.add('open');
    }

    function closeReminderModal() {
        reminderModal.classList.remove('open');
    }

    function saveReminder() {
        const text = document.getElementById('inputReminder').value;
        // 將文字依換行切割成陣列，並過濾空行
        const newReminders = text.split("\n").map(r => r.trim()).filter(r => r !== "");
        
        appData[currentDate].reminder = newReminders;
        saveDataToStorage();
        renderContent();
        closeReminderModal();
    }

    // 啟動
    init();

  </script>
</body>
</html>
